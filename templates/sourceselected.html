{% extends "base.html" %}

{% block content %}

<div id="top">

  <header>
    <h1><a href="/" class="icon_logo"><i>{{ user['name'] }}</i></a></h1>
    <a href="#mainMenu" class="openMainMenu" hidden></a>
    <nav id="mainMenu">
      <a href="#" class="modalClose" hidden></a>
      <ul>
        <li hidden><a href="#" class="modalClose">Exit Menu</a></li>
        <li><a href="/dashboard">Dashboard</a></li>
        <li class="alternate featured"><a href="/user/signout">Sign Out</a></li>
      </ul>
    </nav>
  </header>

  <main>

    <section id="testimonials">
      <header id="accountDetails">
        <h2>{{source['bot_name']}}</h2>
        <h3>{{source['domain_name']}}</h3>
        <br><br>
        <p>
          Great! You have selected <strong>{{source['selected']|length}}</strong> URLs<br>
          {% if source.ifBotId is none %}
            Click CONFIRM to create your GPT Chatbot.
          {% else %}
            Click CONFIRM to add them to your GPT Chatbot.
          {% endif %}
        </p>

        <section class="source_container">
          <h3>Selected URLs</h3>
          <div class="pagination-row">
            <div>
              <label>URLs per page: </label>
              <select id="pagination-dropdown">
                <option value="10">10</option>
                <option value="20">20</option>
                <option value="50">50</option>
                <option value="100">100</option>
              </select>
            </div>        
            <div id="pagination">
              <!-- Pagination will be generated by JavaScript -->
            </div>
          </div>
          <table id="url-table" class="source_table">
            <!-- Table content will be generated by JavaScript -->
          </table>
        </section>
        <br>

        <section class="onPageButton">
          <a href="/source?id={{source['_id']}}">Go Back</a>
          <button id="source_submit_btn" data-id="{{source['_id']}}" data-botId="{{source['ifBotId']}}">
            <span id="source_submit_btn_text">Confirm</span> <span id="source_submit_btn_loader" class="loader loader--hidden"></span> 
          </button>
        </section>
        
        <p id="source_submit_error" class="error error--hidden"></p>
        
      </header>
    <!-- #testimonials --></section>

  </main>

  <footer>
    <h2 class="icon_logo">GPT<span>Chatbot</span></h2>
    <ul class="onPageLinks">
        <li><a href="#testimonials">Details</a></li>
        <li><a href="#pricing">Subscribe</a></li>
        <li><a href="/dashboard">Dashboard</a></li>
    </ul>
    <p>
      &copy; 2023 GPTChatbot. All rights reserved.
    </p>
    <ul class="socialLinks">
      <li>
        <a href="#" class="icon_twitter">
          <span>Twitter</span>
        </a>
      </li><li>
        <a href="#" class="icon_github">
          <span>Github</span>
        </a>
      </li>
    </ul>
  </footer>

</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const urlTable = document.getElementById("url-table");
    const pagination = document.getElementById("pagination");
    const dropdown = document.getElementById("pagination-dropdown");
    const urlList = generateUrls();
    let urlsPerPage = 10;
    let currentPage = 1;

    displayUrls();
    displayPagination();

    // Generate URLs
    function generateUrls() {
      const urls = JSON.parse(`{{source.selected|tojson}}`);
      return urls;
    }

    // Display URLs with pagination
    function displayUrls() {
      const startIndex = (currentPage - 1) * urlsPerPage;
      const endIndex = startIndex + urlsPerPage;
      const urlsToDisplay = urlList.slice(startIndex, endIndex);

      let tableContent = "";

      urlsToDisplay.forEach((url) => {
        tableContent += ` <tr class="source_link_row">
          <td class="source_link_text">${url.url}</td>
          <td class="hidden"><input type="checkbox" class="url-checkbox source_action"></td>
          </tr> `;
      });
      urlTable.innerHTML = tableContent;
    }

    // Display pagination
    function displayPagination() {
      const pageCount = Math.ceil(urlList.length / urlsPerPage);
      let paginationContent = "";

      for (let i = 1; i <= pageCount; i++) {
        paginationContent += `<button class="pagination-btn${
          i === currentPage ? " current-page" : ""
        }" data-page="${i}">${i}</button>`;
      }

      pagination.innerHTML = paginationContent;
      addPaginationListeners();
    }

    // Pagination event listeners
    function addPaginationListeners() {
      const paginationBtns = document.querySelectorAll(".pagination-btn");

      paginationBtns.forEach((btn) => {
        btn.addEventListener("click", function () {
          currentPage = parseInt(this.getAttribute("data-page"));
          displayUrls();
          displayPagination();
        });
      });

      dropdown.addEventListener("change", function(event) {
        urlsPerPage = parseInt(event.target.value);
        currentPage = 1;
        displayUrls();
        displayPagination();
      });
    }

  });
</script>

{% endblock %}